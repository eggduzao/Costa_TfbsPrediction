
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ----------------------------------------------------------------------
% Class: Chapter4.tex
% Author: Eduardo Gade Gusmao
% ----------------------------------------------------------------------
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Header
\chapter{Metodologia}

% Figures file
\graphicspath{{4_Chapter4/Figures/}}

% Descrição do capítulo 4 
Neste capítulo, será descrita a forma como os experimentos foram realizados. Serão dados detalhes a respeito das bases de dados utilizadas e os repositórios onde elas foram obtidas. Então, todos os procedimentos realizados serão descritos, envolvendo: \emph{motif matching}, análise de enriquecimento dos dados de digestão de DNase~I (regiões hipersensíveis à DNase~I) e de dados obtidos através de ChIP-seq (para os fatores de transcrição), processamento dos sinais genômicos obtidos com DNase-seq e ChIP-seq e aplicação dos HMMs para realizar \emph{footprinting} automático. Será descrita também a forma como os resultados foram validados utilizando \emph{gold standards} bem estabelecidos na literatura.

% Proposta do estudo
Deve-se destacar que a principal finalidade dos experimentos descritos a seguir é o melhoramento da identificação de sítios de ligação de fatores de transcrição. A partir da discussão realizada anteriormente sobre os fatores epigenéticos, propomos que a adição de sinais genômicos relativos às modificações nas caudas das histonas acrescente informações ao modelo capazes de suprir algumas deficiências a partir do uso de dados relativos à digestão da DNase apenas. Deste estudo, duas contribuições maiores são apontadas: a construção de um modelo capaz de melhorar o desempenho e a criação de um novo método para treinar o modelo sem precisar se basear em dados validados através de técnicas experimentais custosas.

% Overview da proposta
Após a obtenção dos dados nos repositórios específicos (Seção~\ref{sec:basedados}), o processo experimental começa com a aplicação da técnica \emph{motif matching} para gerar os resultados necessários para formação do \emph{gold standard} (Seção~\ref{sec:mmrealizado}). Após, é realizada a identificação das regiões hipersensíveis à DNase~I (HS, do Inglês \emph{DNase~I Hypersensitivity Site}) e regiões de picos nos dados de ChIP-seq para os TFs (Seção~\ref{sec:enriquecimento}). As regiões enriquecidas nos dados de ChIP-seq também são necessárias para a criação do \emph{gold standard}. Depois, os sinais epigenéticos (cromatina descondensada e modificações de histonas) são processados, gerando a entrada para os HMMs (Seção~\ref{sec:processamento}). De posse de tais sinais processados, os HMMs são construídos (Seção~\ref{sec:processamento}), treinados e aplicados nas regiões de HS (Seção~\ref{sec:estimacaohmmrealizada}). Os resultados da aplicação de tal modelo, isto é, as predições dos sítios de ligação de fatores de transcrição são avaliados a partir de um \emph{gold standard} bastante utilizado na literatura (Seção~\ref{sec:goldstandard}). A Figura~\ref{gusmao_1_Pipeline} mostra, de forma esquemática, todo o processo experimental. A seguir, todos os procedimentos exibidos nesta figura serão descritos.

\vspace{0.0cm}
\figuremacroW{gusmao_1_Pipeline}{Fases do processo experimental}{Esquema que demonstra todas as fases do processo experimental. Neste diagrama, o experimento foi dividido em \emph{Aplicação do Modelo} (linhas vermelhas) e \emph{Validação} (linhas verdes). Retângulos exibem dados obtidos (amarelos) ou gerados (azuis) e as setas conectando os retângulos representam as fases do experimento.}{1.0}
\vspace{0.0cm}

% 4.1. Bases de Dados
\section{Bases de Dados}\label{sec:basedados}

% Projeto ENCODE
O ENCODE (do Inglês, \emph{Encyclopedia of DNA Elements}) \citep{encode2004,encode2007,encode2011a,encode2011b} é um projeto que pretende estudar o genoma funcional nos humanos. Este projeto esta atualmente hospedado no \emph{Genome Browser}\citep{kent2002a}. Esse consórcio, com pouco mais do que 5 anos, consiste em um esforço por parte de vários laboratórios para criar anotações funcionais de forma pangenômica. Tais anotações incluem interações na cromatina, metilação no DNA, modificações de histonas, cromatina descondensada (digestão de DNase~I e FAIRE), perfis de RNA, sítios de ligação de fatores de transcrição e outros. Atualmente, tais dados estão disponíveis para cerca de 200 linhagens celulares humanas diferentes. Diversos dados, como será descrito em seguida, foram obtidos através do projeto ENCODE. Todos os dados utilizados neste projeto se referem à linha celular de leucemia mielóide aguda, K562.

% Tabelas
A Tabela~\ref{tab:fontesdados} sumariza todas as faixas de dados do \emph{Genome Browser} utilizadas e exibe os endereços virtuais para o acesso das mesmas. Os endereços virtuais exibidos contêm informações detalhadas sobre os protocolos sob o quais os dados foram gerados, incluindo a forma como foram realizadas a digestão com DNase~I, a imunoprecipitação, o sequenciamento e o alinhamento. Além disso, esta tabela também contém os repositórios onde as PWMs foram obtidas. Informações sobre os sinais epigenéticos, fatores de transcrição e PWMs utilizadas são exibidas na Tabela~\ref{tab:dadosusados}. Acredita-se que os fatores analisados neste estudo sejam bem representativos, sendo alguns deles bastante utilizado em estudos do gênero \citep{boyle2011,pique2011,cuellar2012}. As modificações de histonas nas quais o experimento foi focado possuem forte presença em regiões de cromatina descondensada. Por este motivo elas foram escolhidas e serão chamadas de \emph{histonas ativadoras}.

\begin{table}[h!]
\vspace{0.5cm}
\begin{center}
\caption[Fontes dos dados]{{\bf Fontes dos dados.}}
    \renewcommand{\arraystretch}{1.2}
    \begin{tabular}{lll}
        \hline
            \bf{Fonte} & \bf{Tipo} & \bf{URL} \\       
        \hline
            Human Genome hg19 & genoma completo & http://bit.ly/oHXPgq \\
        \hline
            Duke DNase & cromatina descondensada (DNase-seq) & http://bit.ly/wOwc8R \\
        \hline
            Broad Histone & modificação de histona (ChIP-seq) & http://bit.ly/xKQLS7 \\
        \hline
            SYDH TFBS & TFBS (ChIP-seq) & http://bit.ly/A0VxYz \\
        \hline
            HAIB TFBS & TFBS (ChIP-seq) & http://bit.ly/zqnhn8 \\
        \hline
            UTA TFBS & TFBS (ChIP-seq) & http://bit.ly/z9b0o1 \\
        \hline
            Jaspar & PWM & http://bit.ly/92ebHi \\
        \hline
            Transfac & PWM & http://bit.ly/PfTeA1 \\
        \hline
            Uniprobe & PWM & http://bit.ly/Qn0kT3 \\
        \hline
            Renlab & PWM & http://bit.ly/RV5c4R \\
        \hline
        \label{tab:fontesdados}
    \end{tabular}
\end{center}
\vspace{0.0cm}
\end{table}

% ENCODE - cromatina descondensada
Os sinais epigenéticos de cromatina descondensada relativos à digestão com DNase~I através de DNase-seq foram obtidos no ENCODE na faixa \emph{Duke DNase}. Nesta faixa estão disponíveis os fragmentos brutos recuperados pelo método de DNase-seq, os fragmentos alinhados, o sinal genômico relativo à aplicação do método F-seq \citep{boyle2008b}, o sinal genômico relativo à simples contagem da sobreposição dos fragmentos obtidos e as regiões enriquecidas. Para este projeto, os fragmentos alinhados foram utilizados para gerar os sinais que posteriormente servirão como entrada para o modelo preditivo e o sinal genômico relativo à aplicação do método F-seq foi utilizado para identificar as regiões enriquecidas, isto é, as regiões hipersensíveis à DNase~I. Não foram utilizados, diretamente, o sinal genômico relativo à contagem da sobreposição dos fragmentos e as regiões enriquecidas calculadas pelo próprio ENCODE pelo fato de a abordagem utilizada nesta faixa ter algumas divergências em relação estudo com o qual se pretende comparar o método proposto.

\renewcommand{\multirowsetup}{\centering}
\begin{table}[htp]
\vspace{0.5cm}
\begin{center}
\caption[Sinais epigenéticos e fatores estudados]{{\bf Sinais epigenéticos e fatores estudados --} Cada fator estudado possui uma trinca no formato (J,T,R) associado (abaixo do mesmo). Os três números de cada trinca representam, respectivamente, o número de PWMs obtidas nos repositórios Jaspar, Transfac e Renlab.}
\renewcommand{\arraystretch}{1.2}
  \begin{tabular}{clllll}
  \hline \\[-0.4cm]
      \bf{Sinais Epigenéticos}         & DNase \hspace{0.2cm} & H2A.Z \hspace{0.2cm} & H3K4me2 & H3K4me3 & H3K9ac \hspace{0.1cm} \\[0.2cm]
  \hline \\[-0.4cm]
                   & ATF3    & CEBPB   & CTCF    & E2F4     & GABP     \\
      \bf{Fatores} & (0,1,0) & (0,2,0) & (1,0,1) & (0,2,0)  & (1,1,0)  \\[0.2cm]
  %\cline{2-6} \\[-0.4cm]
      \bf{(J,T,R)} & MEF2A   & P300    & REST    & & \\
                   & (1,0,0) & (0,1,0) & (1,1,0) & & \\[0.2cm]
  \hline
  \label{tab:dadosusados}
  \end{tabular}
\end{center}
\vspace{0.0cm}
\end{table}

% ENCODE - modificação de histonas
Os sinais epigenéticos relativos às modificações de histonas gerados com ChIP-seq foram obtidos no ENCODE na faixa \emph{Broad Histone}, proposta pelo \emph{Broad Institute} e pelo laboratório \emph{Bernstein lab}. Nesta faixa estão disponíveis os fragmentos brutos recuperados pelo método de ChIP-seq, os fragmentos alinhados e o sinal genômico gerado com o programa \emph{Scripture} \citep{guttman2010}. Novamente, apenas os dados relativos aos fragmentos alinhados foram utilizados. Tais dados também servirão de entrada para o modelo preditivo e também para calcular as regiões onde o modelo será aplicado (regiões hipersensíveis à DNase~I).

% ENCODE - ChIP-seq
Os dados relativos aos TFBSs dos fatores utilizados foram obtidos, no ENCODE, a partir das faixas \emph{SYDH TFBS}, \emph{HAIB TFBS} e \emph{UTA TFBS}. A primeira faixa representa o consórcio formado pelas universidades de Stanford, Yale, sul da Califórnia e Harvard; a segunda é provida pelo \emph{Myers Lab} do instituto HudsonAlpha de biotecnologia; e a terceira é provida pela universidade do Texas em Austin. Foram obtidos os sinais genômicos relacionados à sobreposição de fragmentos alinhados, criado de maneira diferente em cada faixa. A faixa \emph{SYDH TFBS} utilizou métodos próprios para criação do sinal genômico (descritos no endereço eletrônico providenciado). A faixa \emph{HAIB TFBS} utilizou o método MACS \citep{zhang2008} para criar tais sinais. Finalmente, a faixa \emph{UTA TFBS} gerou sinais genômicos através do programa F-seq \citep{boyle2008b}.

% Repositórios de PWMs
Além dos sinais e regiões enriquecidas obtidos no ENCODE, foram obtidas PWMs para realizar o procedimento de \emph{motif matching}, em repositórios específicos. Foram obtidos dados nos repositórios Jaspar \citep{bryne2008}, Transfac \citep{matys2006,wingender1996}, Uniprobe \citep{newburger2009} e um \emph{motif} de alta qualidade para o insulador CTCF foi obtido no laboratório Renlab \citep{essien2009}. O critério mínimo para que um \emph{motif} fosse considerado é que ele tivesse sido criado a partir de um vertebrado. Como pode ser visto na Tabela~\ref{tab:dadosusados} podem existir mais de uma PWM para cada fator, até para cada repositório. Como cada uma dessas PWMs redundantes foram geradas com um processo específico que possui sua própria qualidade, foi optado por utilizar todos os \emph{motifs} encontrados para todos os fatores. O processo de \emph{motif matching} é utilizado, assim como os dados de TFBS com ChIP-seq, apenas para criar o \emph{gold standard}.

% 4.2. Motif Matching
\section{Motif Matching}\label{sec:mmrealizado}

% Motif matching
Todas as PWMs obtidas foram utilizadas para realizar \emph{motif matching} no genoma completo. Essa técnica produz \emph{bit scores} que podem ser utilizados para avaliar a qualidade de cada emparelhamento. Para permitir uma comparação direta com o modelo prévio, foi seguida a sua metodologia para aceitação de TFBSs obtidos através desta técnica. Essa metodologia consiste em descartar todos os emparelhamentos que obtiveram \emph{bit scores} menores do que o mínimo entre: 70\% do maior \emph{bit score} possível (sequência consenso do PWM) e 90\% da diferença entre o maior e o menor possível \emph{bit score} \citep{boyle2011}. Neste trabalho será utilizada a nomenclatura MPBS (do Inglês, \emph{Motif Predicted Binding Site}), para denotar os TFBSs preditos através deste método.

% Ferramenta utilizada 
Para realizar o procedimento de MM, foi utilizado o módulo \emph{Bio.Motif} para análise de \emph{motifs} da ferramenta \emph{Biopython} \citep{cock2009}. Essa ferramenta utiliza um modelo baseado em probabilidade de fundo (\emph{background}) assim como visto na Seção~\ref{ssec:motifmatching}. Esse parâmetro, que assume um valor real $ v $ em escala logarítmica, permite selecionar os emparelhamentos que ocorreram com probabilidade $ 2^v $ vezes maior do que o esperado por chance, dadas as frequências dos nucleotídeos naturais do genoma. Ao utilizar o valor $ v = 0 $, foram selecionados todos os resultados que ocorriam com maior probabilidade do que o esperado por acaso (pois $ 2^0 = 1 $, portanto todos os valores mais prováveis que o fundo são selecionados). Apenas após essa filtragem inicial o método descrito em \citep{boyle2011} foi aplicado (em concordância com o proposto por estes).

% 4.3. Análises de Enriquecimento
\section{Análises de Enriquecimento}\label{sec:enriquecimento}

% Análise de enriquecimento - gamma
Para ter acesso às regiões hipersensíveis à DNase~I e regiões de picos nos dados de ChIP-seq foi realizada uma análise estatística de enriquecimento simples. Tal análise foi realizada nos dados relativos aos sinais genômicos de DNase-seq ou ChIP-seq (para os TFs), obtidos a partir da aplicação dos métodos específicos para contagem de sinais descrita em cada repositório avaliado. A análise de enriquecimento consistiu no ajuste destes sinais contínuos à distribuições $ \Gamma $, definida nas Equações~\ref{eq:gammadist} (distribuição $ \Gamma $ com parâmetros $ k $ e $ \theta $) e ~\ref{eq:gammafun} (função $ \Gamma $ utilizada na definição da distribuição).

\begin{align}
	f(x;k,\theta) = \frac{1}{\theta^k} \frac{1}{\Gamma(k)} x^{k-1} e^{-\frac{x}{\theta}}
	\label{eq:gammadist}
\end{align}

\begin{align}
	\Gamma(n) = (n-1)!
	\label{eq:gammafun}
\end{align}

% O ajuste
O procedimento de ajuste é simples. É calculada a média $ \mu $ e a variância $ \sigma^2 $ da amostra, isto é, dos sinais epigenéticos, em todo o genoma. A média e a variância são então utilizadas para estimar os parâmetros $ k $ e $ \theta $ através da resolução de um sistema de equações com os seguintes resultados probabilísticos: $ \mu = k\theta $ e $ \sigma^2 = k\theta^2 $. Esses parâmetros são então utilizados para inferir o \emph{p-value} de corte, para o qual os valores inferiores serão as regiões não-enriquecidas e os valores superiores serão as regiões enriquecidas. Esta função é comumente utilizada para este propósito por possuir características semelhantes às distribuições reais dos sinais obtidos através de métodos como DNase-seq e ChIP-seq. A distribuição exponencial também é bastante utilizada, porém como a distribuição $ \Gamma $ foi utilizada no estudo com o qual se pretende realizar as comparações, a última foi escolhida para reproduzir mais fielmente os resultados.

% Regiões de HS e picos no ChIP-seq para fatores
Baseando-se nos ajustes realizados, foram consideradas como regiões enriquecidas aquelas que possuíram valores maiores ou iguais ao valor correspondente ao \emph{p-value} de 0.05. É importante constatar que o próprio ENCODE disponibiliza tal análise estatística, porém tais dados não foram utilizados pois a metodologia, de uma forma geral, era diferente. O \emph{p-value} utilizado foi escolhido em conformidade com objetivo de comparar este modelo com o previamente proposto em \citep{boyle2011}.

% 4.4. Processamento dos Sinais Epigenéticos
\section{Processamento dos Sinais Epigenéticos}\label{sec:processamento}

% Processamento de counts - DNase-seq
A primeira fase do processamento dos sinais dos dados de DNase-seq consiste na contagem das sobreposições dos fragmentos alinhados. Neste caso, foi considerado apenas o bp na extremidade 5$^\prime$ dos fragmentos, correspondendo à posição exata no qual a enzima DNase~I digeriu o DNA. Tal abordagem gera um sinal de alta resolução bastante específico, capaz de delinear claramente as proteínas ligadas ao DNA.

% Processamento de counts - ChIP-seq de histonas
Para a geração dos sinais de contagem bruta para os dados de modificação de histonas obtidos através de ChIP-seq, o mesmo procedimento foi aplicado. Entretanto, como o nucleossomo alvo pode se encontrar em qualquer posição do fragmento recuperado através de ChIP, os fragmentos foram estendidos até o tamanho de 200 bp, que representa a média de tais fragmentos reais (os fragmentos são sequenciados apenas nas primeiras 36 bases). A diferença na resolução entre os dois sinais gera padrões específicos, analisados em mais detalhes na Seção~\ref{sec:footprinting}.

% Normalização do DNase-seq e ChIP-seq
Os dados de cromatina descondensada (DNase-seq) foram normalizados de forma a minimizar a variação entre o tamanho dos picos ao longo do genoma. Tal normalização seguiu o método local proposto em \citep{boyle2011}. Neste método, cada sinal (em cada coordenada genômica) é dividido pela média de todas as entradas maiores que 0 em uma janela de tamanho igual a 1 kb ao redor desta coordenada genômica. A principal característica desta normalização é a preservação das nuances dadas pela alta resolução do método DNase-seq. Os dados de ChIP-seq foram submetidos a uma simples função logarítmica, com objetivo de suavizar as curvas ao longo do genoma. O método utilizado para os dados de DNase-seq não foi utilizado para os sinais de modificações de histonas, pelo fato de que a intensidade deste sinal é importante para o modelo, enquanto a intensidade do sinal de DNase-seq não tem grande importância (como será visto na Seção~\ref{sec:footprinting}).

% Savitzky-Golay do DNase-seq
Os dados de DNase-seq passam por mais uma etapa, com objetivo de extrair as características necessárias para o modelo que será descrito em detalhes na Seção~\ref{sec:footprinting}. Essa etapa consiste em duas fases. Na primeira, os dados são suavizados através do filtro estatístico de Savitzky-Golay \citep{gorry1990,leach1984,luo2005,madden1978,press1992}. Tal suavização remove ruídos naturais deste sinal epigenético. A suavização é baseada no ajuste dos sinais normalizados a um polinômio de grau 2 através de uma convolução com uma janela de tamanho 8 bp (excluindo o bp central). A segunda etapa consiste na diferenciação deste sinal epigenético, através da computação da $ 1^a $ derivada \citep{boyle2011}.

% Savitzky-Golay - slope
Os sinais gerados após a suavização e derivação representam a inclinação (em Inglês, \emph{slope}) do sinal normalizado. Isto quer dizer que, nos locais onde o sinal normalizado tinha um movimento crescente, o sinal relativo à inclinação assumia valores positivos; e nos locais onde o sinal normalizado tinha um movimento decrescente, o sinal relativo à inclinação assumia valores negativos. Além disso, quanto mais íngreme a elevação ou queda do sinal normalizado, maiores são os valores da inclinação correspondente (em termos absolutos).

% Processamento - figura
A Figura~\ref{gusmao_1_Processamento} exibe um exemplo do sinal obtido através de DNase-seq, em todas as fases do processamento, para um trecho do cromossomo~6. Esta figura foi gerada utilizando o \emph{Genome Browser} e contém um formato adicional para os dados processados, não utilizado no processo experimental: o sinal estendido. Este sinal é gerado a partir da extensão dos fragmentos alinhados em 5 bp para a esquerda e para a direita da coordenada onde a enzima DNase I digeriu o DNA. O objetivo de tal sinal é facilitar a visualização e a interpretação dos outros sinais.

\vspace{0.0cm}
\figuremacroW{gusmao_1_Processamento}{Modificação dos sinais ao longo do processamento}{Esquema que exibe os sinais de DNase-seq em todas as fases do processamento para um trecho do cromossomo~6. Em azul está o sinal estendido (ver descrição no texto), em preto o sinal correspondente à contagem bruta dos dados, em vermelho o sinal normalizado e em verde o sinal obtido após a aplicação da suavização e diferenciação através do método de Savitzky-Golay.}{1.0}
\vspace{0.0cm}

% 4.5. Footprinting com HMMs
\section{Footprinting com HMMs}\label{sec:footprinting}

% Tipo de sinal buscado - DNase
Foi constatado em \citep{boyle2011} que um TFBS poderia ser caracterizado através dos sinais de cromatina descondensada gerados com DNase-seq como uma depleção de sinal entre dois picos. Isto se explica pelo fato de que naquela região onde a proteína estava ligada não havia digestão da DNase, porém nas regiões imediatamente anterior e posterior a clivagem ocorre. Tal padrão será intitulado pico-vale-pico. O padrão que se deseja reconhecer é formado, nos sinais normalizados, por uma subida e descida (primeiro pico), então uma região relativamente plana (vale) e outra subida e descida (segundo pico). Tal padrão é facilmente representado através dos sinais de inclinação, dado que subidas são representadas por valores positivos e descidas são representadas por valores negativos. Boyle et al. utilizaram essa ideia para construir seu HMM capaz de predizer TFBSs (Figura~\ref{gusmao_1_BoyleHMM}).

\vspace{0.0cm}
\figuremacroW{gusmao_1_BoyleHMM}{HMM que utiliza dados de DNase-seq apenas}{Esquema gráfico do HMM proposto por Boyle et al. (esquerda) para predizer TFBSs com base apenas em sinais obtidos através de DNase-seq. Exemplo dos estados obtidos, em cada coordenada genômica, a partir da aplicação deste modelo em um trecho da região promotora do gene FMR1 no cromossomo X (direita). Fonte: \citep{boyle2011}}{1.0}
\vspace{0.0cm}

% Tipo de sinal buscado - adição das histonas
Ao serem adicionados os sinais de histonas, um padrão levemente diferente ocorre. Dado que os sinais gerados através de ChIP-seq possuem resolução um pouco menor, uma região inteira de HS (que correspondem à blocos com vários picos agrupados no sinal obtido com DNase-seq) corresponde a uma região de depleção nas histonas ativadoras. Foi observado (ver Seção~\ref{sec:ressinaisepi}) que o sinal das modificações de histona ativadores constituem outro padrão de pico-vale-pico, porém em um nível mais alto do que o padrão gerado por cromatina descondensada. Dois picos de histonas ativadoras (sinais intensos) delimitam regiões de HS, que por sua vez possuem vários padrões pico-vale-pico correspondentes aos sítios de ligação.

% Estrutura do HMM
Realizada esta discussão sobre as características dos sinais epigenéticos, pode-se definir a estrutura do novo HMM proposto. Tal modelo deve ser capaz de reconhecer tal padrão formado por, simultaneamente, um sinal de cromatina descondensada e um sinal de histona (isto é, um modelo bivariado). O modelo possui um estado para sinais de fundo (\emph{background} -- \emph{BACK}), que correspondem aos sinais baixos para ambas cromatina descondensada e modificação de histona, geralmente no início ou fim das regiões onde os modelos foram aplicados. Ao encontrar valores significativamente altos de modificação de histonas (primeiro pico), o modelo procede para o estado \emph{High Histone (HH)}. Então esse valor irá reduzir um pouco entrando na região de HS. Nesta região o modelo irá variar entre os estados de crescimento de sinal de cromatina descondensada (\emph{UP}), decrescimento deste sinal (\emph{DOWN}) e regiões de vale (\emph{Footprint} -- \emph{FP}). Esta última região corresponde aos sítios de ligação de fatores de transcrição. Após a região de HS, o método poderá: (1) retornar para o estado \emph{HH}, caso o segundo pico exista (ou, mais comumente, existirem várias regiões de HS na região sendo analisada, delimitadas por vários picos de modificações de histonas); (2) retornar para o estado \emph{BACK}, quando os sinais de histona forem demasiadamente baixos ou não existirem mais regiões de HS. A Figura~\ref{gusmao_1_ModelSignal1} demonstra o HMM criado (lado esquerdo) e o explica através de um gráfico com os sinais de digestão de DNase e a histona variante H2A.Z (lado direito).

\vspace{0.9cm}
\figuremacroW{gusmao_1_ModelSignal1}{Modelagem do HMM e exemplo de aplicação}{HMM utilizado neste estudo (esquerda) contendo 5 estados. O estado \emph{BACK} (azul claro) representa as regiões de pequena intensidade de sinais. O estado \emph{HH} (azul escuro) representa as regiões de alta intensidade de histonas modificadas. O estado \emph{UP} (verde) e \emph{DOWN} (vermelho) representam, respectivamente, as regiões onde os sinais de digestão de DNase~I crescem e decrescem. E o estado \emph{FP} (amarelo) representa as regiões de vale que correspondem aos TFBSs (ou \emph{footprints}). O gráfico (direita) corresponde à média dos sinais (para a digestão de DNase~I e a histona variante H2A.Z) obtidos em 100 regiões de tamanho 1000 centralizadas nos 100 MPBSs com maior \emph{bit score}. O mapa de cores abaixo do gráfico mostra os estados do HMM correspondentes à cada posição, baseado nas cores dos estados da figura do HMM.}{1.0}
\vspace{0.8cm}

% 4.6. Estimação de Parâmetros e Aplicação dos HMMs
\section{Estimação de Parâmetros e Aplicação dos HMMs}\label{sec:estimacaohmmrealizada}

% Treinamento do HMM - introdução
Este HMM foi treinado, isto é, seus parâmetros foram estimados, utilizando duas abordagens. A primeira, intitulada \emph{FMR1} consiste na forma proposta em \citep{boyle2011}. Esta estratégia é baseada, inicialmente, em regiões biologicamente validadas através de métodos de baixo rendimento como o \emph{DNase~I Footprinting}. A segunda estratégia, chamada \emph{STAMP} foi elaborada com o intuito de anotar mais regiões inicialmente sem ter que se basear em metodologias biológicas iniciais.

% Treinamento do HMM - FMR1
Na estratégia FMR1, primeiramente deve ser obtida uma região onde TFBSs foram experimentalmente validados através de algum método de alta acurácia. No caso, foi utilizado o resultado de um experimento de \emph{DNase~I Footprinting} tradicional da região promotora do gene FMR1 (\emph{Fragile X Mental Retardation 1}) no cromossomo X \citep{drouin1997}. Essa região é anotada manualmente, isto é, para cada coordenada genômica, é atribuído um estado do HMM com base nos TFBSs comprovados. Posteriormente, a anotação é utilizada para estimar os parâmetros de um primeiro modelo, através da técnica de máxima verossimilhança (Seção~\ref{sec:hmmestimacao}). Este primeiro modelo é então utilizado para anotar automaticamente uma região maior. No caso, as 1000 regiões de HS do cromossomo 6 que possuem maior evidência de enriquecimento foram utilizadas \citep{boyle2011}. Com base nesta anotação mais abrangente, o modelo final é criado novamente através de máxima verossimilhança.

% Treinamento do HMM - STAMP
A segunda abordagem de treinamento, intitulada STAMP, consiste em um novo método proposto. A motivação da criação deste novo método é que, dessa forma, mais regiões poderão ser inicialmente anotadas sem a necessidade de realizar métodos biológicos a priori ou procurar na literatura por regiões que coincidam com trechos onde o treinamento é interessante. Este método utiliza a ferramenta STAMP \citep{mahony2007}, que consiste em uma técnica para se realizar \emph{motif matching} em cadeias de nucleotídeos com base em um repositório contendo diversas PWMs (e não apenas uma PWM). 

% Treinamento do HMM - STAMP detalhes
Em detalhes, o método STAMP é aplicado nas regiões iniciais que serão utilizadas para se realizar a anotação (geralmente, locais onde existem sinais para todas as características epigenéticas em questão, e possuem bom nível de enriquecimento de DNase~I). O algoritmo realiza um \emph{motif matching} mais elaborado na região em questão, utilizando cada uma das PWMs em cada repositório utilizado. Neste caso, foram utilizados os repositórios completos do Jaspar, Transfac (público), Uniprobe e o \emph{motif} CTCF do Renlab. Os resultados são listas contendo probabilidades de afinidade de ligação de cada fator nesta região. Conforme proposto \citep{boyle2011,mahony2007}, foram consideradas como significativos os emparelhamentos que obtiveram afinidade de ligação menor ou igual à $ 10^{-6} $. Tais resultados correspondem a um conjunto de TFBSs de alta qualidade, suficiente para realizar as anotações iniciais.

% Treinamento do HMM - STAMP processo geral
A metodologia completa consiste em: a partir dos resultados desta técnica aplicada nas 10 melhores regiões de HS do cromossomo 6 (utilizado apenas em conformidade com a metodologia prévia) que possuem maior evidência de enriquecimento, tais regiões são manualmente anotadas de forma idêntica à realizada no treinamento FMR1. Tais anotações são então utilizadas para gerar o modelo final através de máxima verossimilhança. Uma segunda rodada de anotação e treinamento, como no treinamento FMR1, não foi realizada por verificar que os parâmetros já eram bastante robustos.

% Aplicação do HMM - HS
Os modelos treinados são aplicados nas regiões de HS identificadas da forma descrita na Seção~\ref{sec:enriquecimento}. Tais regiões não são regiões de HS no sentido biológico literal, mas regiões onde observou-se um enriquecimento na atividade de digestão de DNase~I. Se torna claro, então, a razão de ter escolhido um \emph{p-value} de enriquecimento relativamente alto (0.05). Dessa forma as regiões são um pouco mais largas do que regiões de HS literais, permitindo que os padrões (principalmente os das histonas, que são mais largos) sejam completamente incluídos nas mesmas.

% Aplicação do HMM - resultados
A implementação dos HMMs foi realizada utilizando o pacote em \emph{Python} da \emph{General Hidden Markov Model Library (GHMM)} \citep{schliep2004}. A probabilidade posterior foi utilizada em todos os casos para aferir a sequência de estados escondidos. Os TFBSs preditos correspondem às coordenadas genômicas onde a probabilidade posterior do estado $ FP $ foi maior do que a dos demais estados (ver Seção~\ref{ssec:probposterior}). Tal região foi estendida em 3 bp para a esquerda e para a direita para tornar as predições mais robustas e facilitar a visualização pelos métodos de validação.

% 4.7. Gold Standard
\section{Gold Standard}\label{sec:goldstandard}

% True TFBS vs. false TFBS
O \emph{gold standard} utilizado neste projeto foi baseado em uma abordagem bastante utilizada na literatura \citep{boyle2011,cuellar2012,pique2011}. Ele consiste em um conjunto contendo TFBSs considerados verdadeiros e falsos, criado a partir das MPBSs em conjunto com os dados de ChIP-seq para os fatores de transcrição. TFBSs verdadeiros são todos os MPBSs que se possuem evidência de ChIP-seq e TFBSs falsos são aqueles que não possuem tal evidência. A evidência se apresenta quando pelo menos 1 bp do MPBS apresenta sobreposição com as regiões enriquecidas nos dados de ChIP-seq. Essas regiões enriquecidas foram avaliadas como descrito na Seção~\ref{sec:enriquecimento}.

% Criação das tabelas de contingência
Após a identificação dos TFBSs verdadeiros e falsos para cada fator, uma tabela de contingência pode ser criada através da consideração das predições (ou \emph{footprints}) realizadas. Os verdadeiros positivos (\emph{TP}) são os verdadeiros TFBSs que possuem sobreposição com algum \emph{footprint}; os falsos negativos (\emph{FN}) são os verdadeiros TFBSs que não possuem \emph{footprint} associado; os verdadeiros negativos (\emph{TN}) são falsos TFBSs que não possuem sobreposição com algum \emph{footprint}; e falsos positivos (\emph{FP}) são falsos TFBSs que possuem \emph{footprint} associado. Novamente, a mínima sobreposição de 1 bp já é válida. A partir desta tabela de contingência, é possível calcular as estatísticas utilizadas para avaliar o modelo, apresentadas na Tabela.

% Variações - pique e cuellar, e porquê não foram comparados
O modelo proposto foi comparado apenas com a abordagem prévia em \citep{boyle2011}. O modelo não foi comparado à abordagem CENTIPEDE descrita em \citep{pique2011} e a abordagem Bayesiana detalhada em \citep{cuellar2012} pelo fato de que o conjunto de validação utilizado por eles diferia da proposta do Boyle et al. Primeiramente, em Pique-Regi et al. e Cuellar et al. os TFBSs verdadeiros são aqueles MPBSs que contêm evidência de ChIP-seq (assim como em Boyle et al.), porém os TFBSs falsos consistem nos MPBSs que se sobrepõem em regiões com uma quantidade de fragmentos de ChIP-seq sobrepostos menor ou igual ao experimento controle para esta linhagem celular (também disponível no ENCODE). Apontamos então o fato de que essa abordagem faz com que apenas um subconjunto das instâncias negativas estejam sendo consideradas. Além disso, as instâncias negativas consideradas são apenas aquelas que possuem níveis muito baixos de evidência de ChIP-seq, isto é, são as instâncias negativas mais fáceis de serem classificadas corretamente. Além disso, ao comparar os resultados de sensibilidade vs. taxa de falsos positivos (curva ROC), esses MPBSs que não foram considerados verdadeiros TFBSs nem falsos TFBSs, foram descartados sobre a premissa de que o \emph{gold standard} estaria contaminado com instâncias na fronteira de classificação. A mesma observação anterior, a respeito de isto representar um problema mais fácil do ponto de vista de aprendizado de máquina, se aplica a este argumento.

% 4.8. Considerações Finais
\section{Considerações Finais}\label{sec:cfcap4}

% Considerações finais
Neste capítulo foram descritos em detalhes os procedimentos realizados neste trabalho. Em resumo, foram descritos os procedimentos de obtenção dos dados, o \emph{motif matching}, a análise de enriquecimento dos sinais obtidos através de DNase-seq e ChIP-seq para os fatores de transcrição, o processamento dos sinais de DNase-seq e de ChIP-seq para as modificações de histonas, a modelagem, treinamento e aplicação dos HMMs multivariados, e a forma de validação utilizada para comparar o novo modelo proposto ao modelo prévio. Finalmente, tal modelo prévio também foi replicado, para que os resultados entre os dois fosse comparado dadas as ferramentas utilizadas neste projeto.
